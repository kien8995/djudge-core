#include <cstdio>
#include <list>
#include <algorithm>
using namespace std;
#define INF 2000000000
char tab[40][40];
bool odw[40][40];
int odl[40][40][40][40];
int first[40][40][4];
char get()
{
	char c; while((c=getchar())<=' '); return c;
}
int conv(int x, int y)
{
	return x + 400*y;
}

bool go(int x ,int y, int H, int o,list<int> & Q, int X, int Y)
{
	if(x<0 || y<0 || x>=H || y>=H) return 0;
	if(odw[x][y]) return 0;
	if(tab[x][y]=='.') o++;
	if(o>=odl[x][y][X][Y]) return 0;
	odl[x][y][X][Y]=o;
	odw[x][y]=1;
	if(tab[x][y]=='.')Q.push_back(conv(x,y));
	else Q.push_front(conv(x,y));
	return 1;
}

int jeden()
{
	int H;
	scanf("%d", &H);
	if(H==0) return 0;
	for(int i = 0; i<2*H-1; i++)
		for(int j = 0; j<2*H-1; j++) tab[i][j]='.';
	for(int i = 0; i<H; i++)
	{
		for(int j = 0; j<H+i; j++) tab[i][j]=get();
	}
	for(int i = 1; i<H; i++)
	{
		for(int j = i; j<2*H-1; j++) tab[i+H-1][j]= get();
	}
	H = 2*H-1;
	for(int X = 0; X<H; X++)
		for(int Y = 0; Y<H; Y++)
	{
		list<int> Q;
		Q.push_front(conv(X,Y));
		
		for(int i = 0; i<H; i++)
			for(int j = 0; j<H; j++)
		{
			odl[i][j][X][Y]=INF; odw[i][j]=0;
		}
		odl[X][Y][X][Y]=0;
		while(!Q.empty())
		{
			int x = Q.front()%400;
			int y = Q.front()/400;
			Q.pop_front();
			go(x-1,y-1,H,odl[x][y][X][Y],Q,X,Y);
			go(x+1,y+1,H,odl[x][y][X][Y],Q,X,Y);
			go(x-1,y,H,odl[x][y][X][Y],Q,X,Y);
			go(x,y-1,H,odl[x][y][X][Y],Q,X,Y);
			go(x+1,y,H,odl[x][y][X][Y],Q,X,Y);
			go(x,y+1,H,odl[x][y][X][Y],Q,X,Y);
		}
	}
	
	for(int X = 0; X<H; X++)
		for(int Y = 0; Y<H; Y++)
		{
			for(int k = 0; k<4; k++) first[X][Y][k]=INF;
			for(int i = 0; i<H; i++)
				for(int j = 0; j<H; j++) if(tab[i][j]!='.')
			{
				int w = tab[i][j]-'A';
				if(first[X][Y][w]> odl[X][Y][i][j])
					first[X][Y][w] = odl[X][Y][i][j];
			}
		}
	int mini = INF;
	for(int X = 0; X<H; X++)
		for(int Y = 0; Y<H; Y++)
			for(int i = 0; i<H; i++)
				for(int j = 0; j<H; j++)
	{
		int sum = odl[X][Y][i][j];
		if(tab[X][Y]=='.') sum--;
		if(tab[i][j]=='.') sum--;
		for(int k = 0; k<4; k++)
		{
			sum+=min(first[X][Y][k],first[i][j][k]);
		}
		if(sum<mini) mini = sum;
	}
	/*for(int X = 0; X<H; X++)
		for(int Y = 0; Y<H; Y++)
			for(int i = 0; i<H; i++)
				for(int j = 0; j<H; j++)
					if(odl[X][Y][i][j]<INF)printf("%d\n", odl[X][Y][i][j]);*/
	printf("You have to buy %d parcels.\n", mini);
	return 1;
}

int main()
{
	
	while(jeden());
	return 0;
}
